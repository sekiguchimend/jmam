# プロジェクト構造

## ディレクトリ構成

```
front/
├── app/                          # Next.js App Router
│   ├── layout.tsx               # ルートレイアウト
│   ├── page.tsx                 # トップページ
│   ├── globals.css              # グローバルスタイル
│   ├── (user)/                  # 一般利用者向けルートグループ
│   │   ├── layout.tsx          # 一般利用者用レイアウト
│   │   └── predict/
│   │       └── page.tsx        # 予測ページ（FR-01〜FR-05）
│   └── admin/                   # 管理者向け
│       ├── layout.tsx          # 管理者用レイアウト（認証チェック）
│       ├── page.tsx            # 管理者ダッシュボード（FR-12）
│       └── upload/
│           └── page.tsx        # CSVアップロードページ（FR-07〜FR-11）
│
├── components/                   # Reactコンポーネント
│   ├── ui/                      # 汎用UIコンポーネント
│   │   ├── Button.tsx          # ボタン（#323232/#fff配色）
│   │   ├── Slider.tsx          # スコア入力スライダー（1.0〜4.0）
│   │   ├── Card.tsx            # カードコンテナ
│   │   ├── ProgressBar.tsx     # 進捗バー
│   │   └── index.ts            # UIエクスポート
│   ├── predict/                 # 予測機能コンポーネント
│   │   ├── CaseSelector.tsx    # ケース問題選択（FR-01）
│   │   ├── ScoreInput.tsx      # スコア入力（FR-02）
│   │   ├── PredictionResult.tsx # 予測結果表示（FR-04）
│   │   ├── CompareView.tsx     # 解答比較（FR-05）
│   │   └── index.ts            # 予測コンポーネントエクスポート
│   └── admin/                   # 管理機能コンポーネント
│       ├── CsvUploader.tsx     # CSVアップロード（FR-07, FR-08）
│       ├── UploadProgress.tsx  # 進捗表示（FR-10, FR-11）
│       ├── DatasetList.tsx     # データセット管理（FR-12）
│       └── index.ts            # 管理コンポーネントエクスポート
│
├── lib/                          # ライブラリ・ユーティリティ
│   ├── supabase/
│   │   ├── client.ts           # Supabaseクライアント（anon key）
│   │   ├── queries.ts          # DBクエリ関数
│   │   └── index.ts            # Supabaseエクスポート
│   ├── gemini/
│   │   ├── client.ts           # Google Gemini APIクライアント
│   │   └── index.ts            # Geminiエクスポート
│   └── utils.ts                 # 共通ユーティリティ（CSV解析、バッチ処理等）
│
├── types/                        # TypeScript型定義
│   ├── database.ts              # Supabaseデータベース型
│   └── index.ts                 # 共通型定義（Case, Response, Scores等）
│
├── actions/                      # Server Actions
│   ├── predict.ts               # 予測機能（FR-03: RAG + LLM）
│   └── upload.ts                # CSVアップロード・バッチ処理（FR-07〜FR-11）
│
└── public/                       # 静的ファイル
```

## 各ディレクトリの用途

### `app/` - ルーティング・ページ
Next.js App Routerを使用。Server Componentsをデフォルトとして使用。

| パス | 説明 | 対応機能要件 |
|------|------|-------------|
| `(user)/predict` | 一般利用者向け予測ページ | FR-01〜FR-05 |
| `admin/` | 管理者ダッシュボード | FR-06, FR-12 |
| `admin/upload` | CSVアップロードページ | FR-07〜FR-11 |

### `components/` - UIコンポーネント

#### `ui/` - 汎用コンポーネント
再利用可能な基本UIパーツ。配色は`#323232`と`#fff`を基調。

#### `predict/` - 予測機能コンポーネント
スコア入力から予測結果表示までの一連のUI。

#### `admin/` - 管理機能コンポーネント
CSVアップロード、進捗表示、データセット管理のUI。

### `lib/` - ビジネスロジック

#### `supabase/`
- **client.ts**: anon keyを使用したSupabaseクライアント
- **queries.ts**: ケース取得、類似解答検索、upsert処理

#### `gemini/`
- **client.ts**: RAGによる解答生成（gemini-1.5-flash使用）

#### `utils.ts`
CSV解析、日付・スコア変換、バッチ分割

### `types/` - 型定義
- **database.ts**: Supabaseスキーマに対応する型
- **index.ts**: Case, Response, Scores, PredictionResponse等

### `actions/` - Server Actions
API Routeの代わりにServer Actionsを使用（ユーザー要件）。

- **predict.ts**: 予測処理（類似検索→LLM生成）
- **upload.ts**: CSVアップロード・バッチupsert

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| フレームワーク | Next.js (App Router) |
| データベース | Supabase (PostgreSQL) - anon keyのみ使用 |
| LLM | Google Gemini (gemini-1.5-flash) |
| UI | React, Tailwind CSS |
| 認証 | Next.js Auth（管理画面用） |
| デプロイ | Vercel |

## 配色

CLAUDE.mdの指示に従い、チャットボット風の配色を採用：
- メインカラー: `#323232`（ダークグレー）
- 背景色: `#fff`（白）
